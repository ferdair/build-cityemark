(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{502:function(e,o,r){"use strict";r.r(o);r(7),r(10),r(8),r(12),r(13),r(11),r(31),r(56),r(9);var t=r(20),n=(r(64),r(14)),c=r(2),l=r(83),d=r.n(l),v=r(82),m=r(191);function f(object,e){var o=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),o.push.apply(o,r)}return o}function h(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?f(Object(source),!0).forEach((function(o){Object(c.a)(e,o,source[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):f(Object(source)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(source,o))}))}return e}var R={name:"RegistrarComercio",middleware:["auth","tieneTienda"],data:function(){return{auxiliares:null,valid:!0,nombre:"",nombreRules:[function(e){return!!e||"Nombre es requerido"}],eslogan:"",esloganRules:[function(e){return!!e||"Eslogan es requerido"}],correo:"",correoRules:[function(e){return!!e||"Correo es requerido"},function(e){return/.+@.+\..+/.test(e)||"El correo debe ser válido"}],direccion:"",direccionRules:[function(e){return!!e||"Dirección es requerido"}],error:!1,error_msg:"",provincias:[],provincia:"",ciudades:[],ciudad:"",tipoComercio:"",tiposComercio:[],categoria:"",categorias:[],picture:"",file:null,nuevoTelefono:"",tipoNuevoTelefono:null,telefonos:[],labelTelefonos:["Teléfono sólo llamadas","Teléfono solo Whatsapp","Teléfono para Llamadas y Whatsapp"],nuevaRed:"",nuevoTipoRed:null,redesSociales:[],tiposRedes:null}},computed:h(h({},Object(v.b)(["getAux","loggedInUser"])),{},{fromDateDisp:function(){return this.fromDateVal}}),created:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function o(){var r,n,data,c;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,d.a.get(m.a.endpoint+"/auxiliarComercio.php");case 2:return r=o.sent,n=Object(t.a)(r.data.data,1),data=n[0],e.auxiliares=data,e.provincias=e.auxiliares.provincia.filter((function(e){return"No State"!==e.nombreProv})),e.tiposComercio=e.auxiliares.tipoComercio.filter((function(e){return"Tipo de Comercio"!==e.nombreTipoComercio})),o.next=10,d.a.get(m.a.endpoint+"/redesComercio.php?id=tipoRedSocial");case 10:c=o.sent,e.tiposRedes=c.data.data;case 12:case"end":return o.stop()}}),o)})))()},methods:{validate:function(){this.$refs.form.validate()},reset:function(){this.$refs.form.reset()},resetValidation:function(){this.$refs.form.resetValidation()},subirImagen:function(){var e=this;this.$refs.form.validate();var o=Date.now(),r=this.$fireStorageObj().ref().child("logos/".concat(o)).put(this.file);r.on("state_changed",(function(e){var progress=e.bytesTransferred/e.totalBytes*100;console.log("Upload is "+progress+"% done")}),(function(e){console.log(e)}),(function(){r.snapshot.ref.getDownloadURL().then((function(o){console.log("File available at",o),console.log(o),e.picture=o,e.registrar()}))}))},registrar:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function o(){var r,data;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!e.$refs.form.validate()){o.next=17;break}return r={nombre:e.nombre,eslogan:e.eslogan,correo:e.correo,direccion:e.direccion,ubicacionGPS:"0,0",estado:1,ciudad:e.ciudad,tipoComercio:e.tipoComercio,imagenLogo:e.picture,centroComercial:1,numeroLocal:0,categoria:e.categoria,palabrasClave:"",vendedores:1,observaciones:"",tipoInterno:1},o.next=4,d.a.post(m.a.endpoint+"/datosComercio.php",r);case 4:if(200!==(data=o.sent).data.code){o.next=14;break}return e.telefonos.forEach(function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(element){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.post(m.a.endpoint+"/telefonoComercio.php",{numeroTelefono:element.telefono,idComercio:data.data.data[0].id,tipoTelefono:element.tipoTelefono});case 2:case"end":return e.stop()}}),e)})));return function(o){return e.apply(this,arguments)}}()),e.redesSociales.forEach(function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(element){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return alert(data.data.data[0].id),alert(element.urlRedSocial),alert(element.idTipoRedSocial),e.next=6,d.a.post(m.a.endpoint+"/redesComercio.php",{idComercio:data.data.data[0].id,urlRedSocial:element.urlRedSocial,idTipoRedSocial:element.idTipoRedSocial});case 6:200===(a=e.sent).data.code?alert("exitoso"):alert(a.data.message);case 8:case"end":return e.stop()}}),e)})));return function(o){return e.apply(this,arguments)}}()),o.next=10,d.a.patch(m.a.endpoint+"/usuarioComercio.php",{id:e.loggedInUser.id,campo:"comercio",dato:data.data.data[0].id});case 10:200===o.sent.data.code?(e.loggedInUser.idComercio=data.data.data[0].id,location.replace("/usuarioComercio")):(console.log("sadasd"+e.loggedInUser.idComercio),e.error=!0,e.error_msg=data.data.message),o.next=17;break;case 14:console.log("Error post"),e.error=!0,e.error_msg=data.data.message;case 17:case"end":return o.stop()}}),o)})))()},changeCiudad:function(){var e=this;this.ciudades=this.auxiliares.ciudad.filter((function(o){return o.provincia===e.provincia}))},changeCategoria:function(){var e=this;this.categorias=this.auxiliares.categoria.filter((function(o){return o.tipoComercio===e.tipoComercio}))},uploadImage:function(e){this.file=e.target.files[0]},agregarTelefono:function(){this.telefonos.push({telefono:this.nuevoTelefono,tipoTelefono:this.tipoNuevoTelefono-1}),this.nuevoTelefono=""},quitarTelefono:function(e){this.telefonos=this.telefonos.filter((function(i){return i.telefono!==e}))},agregarRedSocial:function(){alert(this.nuevoTipoRed),this.redesSociales.push({urlRedSocial:this.nuevaRed,idTipoRedSocial:this.nuevoTipoRed}),this.nuevaRed=""},quitarRed:function(e){this.redesSociales=this.redesSociales.filter((function(i){return i.urlRedSocial!==e}))}}},C=r(72),x=r(124),T=r.n(x),_=r(508),k=r(390),w=r(180),S=r(189),y=r(380),O=r(377),V=r(433),j=r(507),D=r(486),P=r(480),I=r(382),E=r(485),N=r(179),L=r(488),$=r(489),U=r(487),A=r(506),F=r(479),G=r(62),B=r(403),component=Object(C.a)(R,(function(){var e=this,o=e.$createElement,r=e._self._c||o;return r("v-app",[r("div",[r("v-container",[r("v-card",{staticClass:"elevation-12"},[r("v-toolbar",{attrs:{dark:"",color:"primary"}},[r("v-toolbar-title",[e._v("Registro de Comercio")])],1),e._v(" "),r("v-card-text",[r("v-container",[r("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.valid,callback:function(o){e.valid=o},expression:"valid"}},[r("v-text-field",{attrs:{rules:e.nombreRules,"prepend-icon":"mdi-store",label:"Nombre",required:""},model:{value:e.nombre,callback:function(o){e.nombre=o},expression:"nombre"}}),e._v(" "),r("v-text-field",{attrs:{label:"Eslogan",rules:e.esloganRules,"prepend-icon":"mdi-bullhorn",required:""},model:{value:e.eslogan,callback:function(o){e.eslogan=o},expression:"eslogan"}}),e._v(" "),r("v-text-field",{attrs:{rules:e.correoRules,label:"Correo","prepend-icon":"mdi-email",required:""},model:{value:e.correo,callback:function(o){e.correo=o},expression:"correo"}}),e._v(" "),r("v-text-field",{attrs:{"prepend-icon":"mdi-compass",label:"Dirección",rules:e.direccionRules,required:""},model:{value:e.direccion,callback:function(o){e.direccion=o},expression:"direccion"}}),e._v(" "),r("v-container",[r("v-row",[r("v-col",{attrs:{cols:"12",md:"5"}},[r("v-text-field",{attrs:{"prepend-icon":"mdi-phone",label:"Telefono"},model:{value:e.nuevoTelefono,callback:function(o){e.nuevoTelefono=o},expression:"nuevoTelefono"}})],1),e._v(" "),r("v-col",{attrs:{cols:"12",md:"5"}},[r("v-radio-group",{model:{value:e.tipoNuevoTelefono,callback:function(o){e.tipoNuevoTelefono=o},expression:"tipoNuevoTelefono"}},e._l(3,(function(o){return r("v-radio",{key:o,attrs:{label:""+e.labelTelefonos[o-1],value:o}})})),1)],1),r("v-col",{attrs:{cols:"12",md:"2"}},[r("v-btn",{staticClass:"mx-2",attrs:{fab:"",dark:"",color:"indigo"},on:{click:e.agregarTelefono}},[r("v-icon",{attrs:{dark:""}},[e._v(" mdi-plus ")])],1)],1)],1),e._v(" "),r("v-row",[r("v-col",[r("v-chip-group",{attrs:{column:""}},e._l(e.telefonos,(function(o,t){return r("v-chip",{key:t,staticClass:"ma-2",attrs:{color:0==o.tipoTelefono?"blue darken-4":1==o.tipoTelefono?"green darken-4":1==o.tipoTelefono?"teal":"red","text-color":"white",close:""},on:{"click:close":function(r){return e.quitarTelefono(o.telefono)}}},[e._v("\n                        "+e._s(o.telefono)+"\n                      ")])})),1)],1)],1)],1),e._v(" "),r("v-container",[r("v-row",[r("v-col",{attrs:{cols:"12",md:"5"}},[r("v-text-field",{attrs:{"prepend-icon":"mdi-earth",label:"Link de Redes Sociales"},model:{value:e.nuevaRed,callback:function(o){e.nuevaRed=o},expression:"nuevaRed"}})],1),e._v(" "),r("v-col",{attrs:{cols:"12",md:"5"}},[r("v-select",{attrs:{items:e.tiposRedes,"item-text":"nombreTipoRed","item-key":"nuevoTipoRed","item-value":"id_tipoRS",label:"Red Social","prepend-icon":"mdi-link-variant"},model:{value:e.nuevoTipoRed,callback:function(o){e.nuevoTipoRed=o},expression:"nuevoTipoRed"}})],1),r("v-col",{attrs:{cols:"12",md:"2"}},[r("v-btn",{staticClass:"mx-2",attrs:{fab:"",dark:"",color:"indigo"},on:{click:e.agregarRedSocial}},[r("v-icon",{attrs:{dark:""}},[e._v(" mdi-plus ")])],1)],1)],1),e._v(" "),r("v-row",[r("v-col",[r("v-chip-group",{attrs:{column:""}},e._l(e.redesSociales,(function(o,t){return r("v-chip",{key:t,staticClass:"ma-2",attrs:{color:"red","text-color":"white",close:""},on:{"click:close":function(r){return e.quitarRed(o.urlRedSocial)}}},[r("v-avatar",{attrs:{left:""}},[r("v-icon",[e._v(e._s(e.tiposRedes[e.nuevoTipoRed-1].observaciones))])],1),e._v("\n                        "+e._s(o.urlRedSocial)+"\n                      ")],1)})),1)],1)],1)],1),e._v(" "),r("v-select",{attrs:{items:e.provincias,"item-text":"nombreProv","item-key":"provincia","item-value":"id_provincia",label:"Provincia","prepend-icon":"mdi-map"},on:{change:e.changeCiudad},model:{value:e.provincia,callback:function(o){e.provincia=o},expression:"provincia"}}),e._v(" "),r("v-select",{attrs:{items:e.ciudades,"item-text":"nombreCiu","item-key":"ciudades","item-value":"id_ciudad",label:"Ciudad","prepend-icon":"mdi-map-marker"},model:{value:e.ciudad,callback:function(o){e.ciudad=o},expression:"ciudad"}}),e._v(" "),r("v-select",{attrs:{items:e.tiposComercio,"item-text":"nombreTipoComercio","item-key":"tipoComercio","item-value":"id_tipoComercio",label:"Tipo de comercio","prepend-icon":"mdi-map"},on:{change:e.changeCategoria},model:{value:e.tipoComercio,callback:function(o){e.tipoComercio=o},expression:"tipoComercio"}}),e._v(" "),r("v-select",{attrs:{items:e.categorias,"item-text":"nombreCat","item-key":"tipoComercio","item-value":"id_categoria",label:"Categoría","prepend-icon":"mdi-map-marker"},model:{value:e.categoria,callback:function(o){e.categoria=o},expression:"categoria"}}),e._v(" "),r("div",[r("p",[e._v("Logo")]),e._v(" "),r("input",{attrs:{type:"file",accept:"image/*"},on:{change:e.uploadImage}})])],1)],1)],1),e._v(" "),r("v-divider"),e._v(" "),r("v-card-actions",[r("v-btn",{staticClass:"mr-4",attrs:{color:"error"},on:{click:e.reset}},[e._v(" Limpiar ")]),e._v(" "),r("v-btn",{attrs:{color:"success"},on:{click:e.subirImagen}},[e._v("Registrar")])],1)],1)],1)],1),e._v(" "),e.error?r("v-alert",{attrs:{type:"error"}},[e._v("\n    "+e._s(e.error_msg)+"\n  ")]):e._e()],1)}),[],!1,null,null,null);o.default=component.exports;T()(component,{VAlert:_.a,VApp:k.a,VAvatar:w.a,VBtn:S.a,VCard:y.a,VCardActions:O.a,VCardText:O.c,VChip:V.a,VChipGroup:j.a,VCol:D.a,VContainer:P.a,VDivider:I.a,VForm:E.a,VIcon:N.a,VRadio:L.a,VRadioGroup:$.a,VRow:U.a,VSelect:A.a,VTextField:F.a,VToolbar:G.a,VToolbarTitle:B.a})}}]);